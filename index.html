<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Concierge</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-size: cover;
      background-position: center;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 30px;
      max-width: 500px;
      width: 100%;
    }

    .top-bar {
      display: flex;
      justify-content: flex-end;
    }

    #hotelLogo {
      display: block;
      margin: 0 auto 20px auto;
      height: 180px;
      max-height: 200px;
      object-fit: contain;
    }

    .header-title {
      font-weight: bold;
      font-size: 18px;
      color: #2c3e50;
      margin-bottom: 5px;
      text-align: center;
    }

    .top-bar img {
      height: 40px;
    }

    .language-switcher select {
      border-radius: 20px;
      padding: 5px;
      font-size: 14px;
    }

    h1 {
      font-size: 22px;
      color: #2c3e50;
    }

    p {
      font-size: 16px;
      color: #333;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 10px;
    }

    input[type="date"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 20px;
    }

    .checkbox {
      margin-bottom: 20px;
    }

    #consentLabel {
      font-size: 13px;
    }

    button {
      background-color: #25D366;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }

    button:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }

    button#withoutConsentBtn {
      background-color: transparent;
      color: #25D366;
      border: 2px solid #25D366;
      margin-top: 10px;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }

    .footer {
      margin-top: 20px;
      font-size: 12px;
      color: #888;
      text-align: center;
    }

    @media (max-width: 600px) {
      #hotelLogo {
        height: 80px;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="main">
    <div class="top-bar">
      <div class="language-switcher">
        <select id="languageSelect">
          <option value="ar">ðŸ‡²ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
          <option value="en">ðŸ‡¬ðŸ‡§ English</option>
          <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
          <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
        </select>
      </div>
    </div>
    <img id="hotelLogo" src="" alt="Hotel Logo">
    <div class="header-title" id="headerTitle"></div>

    <p id="welcomeText"></p>

    <label for="checkout" id="checkoutLabel"></label>
    <input type="date" id="checkout" name="checkout">

    <div class="checkbox">
      <label id="consentLabel">
        <input type="checkbox" id="consentCheckbox">
      </label>
    </div>

    <button id="withConsentBtn" disabled></button>
    <button id="withoutConsentBtn"></button>

    <div class="footer" id="footerText"></div>
    <div class="footer">Powered by SmartPath</div>
  </div>

  <script>
    // Translation texts for each supported language
    const translations = {
      ar: {
        title: (hotelName) => `ÙƒÙˆÙ†Ø³ÙŠØ±Ø¬ ÙÙ†Ø¯Ù‚ ${hotelName} Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨`,
        welcomeText: "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ. ØªØªÙˆÙØ± Ø®Ø¯Ù…Ø© Ø§Ù„ÙƒÙˆÙ†Ø³ÙŠØ±Ø¬ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø®Ù„Ø§Ù„ Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©.",
        checkoutLabel: "Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©ØŸ",
        consentText: (hotelName) => `Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ ØªÙ„Ù‚ÙŠ Ø±Ø³Ø§Ø¦Ù„ Ø®Ø¯Ù…Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ù† ${hotelName} Ø®Ù„Ø§Ù„ Ø¥Ù‚Ø§Ù…ØªÙŠ ÙˆØ­ØªÙ‰ 7 Ø£ÙŠØ§Ù… Ø¨Ø¹Ø¯Ù‡Ø§ (ØªØ°ÙƒÙŠØ± Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø© ÙˆØ±Ø§Ø¨Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…). Ø£Ø±Ø³Ù„ STOP Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.`,
        withConsentBtn: "Ø£ÙˆØ§ÙÙ‚ ÙˆØ£ØªØ§Ø¨Ø¹ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨",
        withoutConsentBtn: "Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø¯ÙˆÙ† ØªØ­Ø¯ÙŠØ«Ø§Øª",
        footer: "Ø¨Ù…ÙˆØ¬Ø¨ Ø³ÙŠØ§Ø³Ø© Ø£Ø¹Ù…Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø­Ø¨ Ù…ÙˆØ§ÙÙ‚ØªÙƒ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª.",
        messageWithDate: (date, code) => `Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø£Ø±ØºØ¨ ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø°ÙƒÙŠ. ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø© Ù‡Ùˆ ${date}. Ø±Ù…Ø²ÙŠ Ù‡Ùˆ ${code}`,
        messageWithoutDate: (code) => `Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø£Ø±ØºØ¨ ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø°ÙƒÙŠ. Ø±Ù…Ø²ÙŠ Ù‡Ùˆ ${code}`,
        messageWithDateAndOptin: (date, code) => `empty`,
        messageWithoutDateAndOptin: (code) => `empty`
      },
      en: {
        title: (hotelName) => `${hotelName} Concierge on WhatsApp`,
        welcomeText: "Welcome. Our concierge is available on WhatsApp to help during your stay.",
        checkoutLabel: "Would you like to enter your checkout date?",
        consentText: (hotelName) => `I agree to receive WhatsApp service updates from ${hotelName} during my stay and up to 7 days after (checkout reminder & review link). Reply STOP to opt out.`,
        withConsentBtn: "Agree and continue on WhatsApp",
        withoutConsentBtn: "Continue without updates",
        footer: "According to WhatsApp Business Policy, you may withdraw your consent at any time.",
        messageWithDate: (date, code) => `Hello, I would like to use the AI concierge. My checkout date is ${date}. My code is ${code}`,
        messageWithoutDate: (code) => `Hello, I would like to use the AI concierge. My code is ${code}`,
        messageWithDateAndOptin: (date, code) => `empty`,
        messageWithoutDateAndOptin: (code) => `empty`
      },
      es: {
        title: (hotelName) => `Conserje de ${hotelName} por WhatsApp`,
        welcomeText: "Nos complace darle la bienvenida. Para mejorar su experiencia, nuestro conserje virtual estÃ¡ disponible en WhatsApp.",
        checkoutLabel: "Â¿Desea ingresar su fecha de salida?",
        consentText: (hotelName) => `Acepto recibir mensajes de servicio por WhatsApp de ${hotelName} durante mi estancia y hasta 7 dÃ­as despuÃ©s (recordatorio de salida y enlace de reseÃ±a). Responda STOP para darse de baja.`,
        withConsentBtn: "Acepto y continÃºo por WhatsApp",
        withoutConsentBtn: "Continuar sin actualizaciones",
        footer: "SegÃºn la polÃ­tica de WhatsApp Business, puede retirar su consentimiento en cualquier momento.",
        messageWithDate: (date, code) => `Hola, me gustarÃ­a utilizar el conserje virtual. Mi fecha de salida es ${date}. Mi cÃ³digo es ${code}`,
        messageWithoutDate: (code) => `Hola, me gustarÃ­a utilizar el conserje virtual. Mi cÃ³digo es ${code}`,
        messageWithDateAndOptin: (date, code) => `empty`,
        messageWithoutDateAndOptin: (code) => `empty`
      },
      fr: {
        title: (hotelName) => `Conciergerie de ${hotelName} sur WhatsApp`,
        welcomeText: "Bienvenue. Notre conciergerie est disponible sur WhatsApp pour vous aider pendant votre sÃ©jour.",
        checkoutLabel: "Souhaitez-vous renseigner votre date de dÃ©part ?",
        consentText: (hotelName) => `Jâ€™accepte de recevoir des messages de service WhatsApp de ${hotelName} pendant mon sÃ©jour et jusquâ€™Ã  7 jours aprÃ¨s (rappel de dÃ©part & lien dâ€™avis). RÃ©pondez STOP pour vous dÃ©sabonner.`,
        withConsentBtn: "Jâ€™accepte et je continue sur WhatsApp",
        withoutConsentBtn: "Continuer sans mises Ã  jour",
        footer: "ConformÃ©ment Ã  la politique WhatsApp Business, vous pouvez retirer votre consentement Ã  tout moment.",
        messageWithDate: (date, code) => `Bonjour, je souhaite utiliser le concierge IA. Ma date de dÃ©part est le ${date}. Mon code est ${code}`,
        messageWithoutDate: (code) => `Bonjour, je souhaite utiliser le concierge IA. Mon code est ${code}`,
        messageWithDateAndOptin: (date, code) => `empty`,
        messageWithoutDateAndOptin: (code) => `empty`
      }
    };

    // Elements
    const languageSelect = document.getElementById('languageSelect');
    const checkoutInput = document.getElementById('checkout');
    const withConsentBtn = document.getElementById('withConsentBtn');
    const withoutConsentBtn = document.getElementById('withoutConsentBtn');
    let currentLang = 'en';
    let hotelData = null;

    // Set UI language dynamically
    function setLanguage(lang) {
      if (!translations[lang]) lang = 'en';
      currentLang = lang;

      document.documentElement.lang = lang;
      document.body.style.direction = lang === 'ar' ? 'rtl' : 'ltr';
      languageSelect.value = lang;

      const t = translations[lang];
      const hotelName = hotelData?.name || '';

      document.getElementById('headerTitle').innerText = t.title(hotelName);
      document.getElementById('welcomeText').innerText = t.welcomeText;
      document.getElementById('checkoutLabel').innerText = t.checkoutLabel;
      document.getElementById('consentLabel').innerHTML =
        `<input type="checkbox" id="consentCheckbox"> ${t.consentText(hotelName)}`;
      document.getElementById('footerText').innerText = t.footer;
      withConsentBtn.innerText = t.withConsentBtn;
      withoutConsentBtn.innerText = t.withoutConsentBtn;
    }

    // Generate temporary guest code
    function generateTempCode(length = 8) {
      const characters = 'abcdefghijklmnopqrstuvwxyz0123456789';
      let result = '';
      for (let i = 0; i < length; i++) {
        result += characters[Math.floor(Math.random() * characters.length)];
      }
      return result;
    }

    function handleButtonClick(isConsentGiven) {
      const checkoutDate = checkoutInput.value || null;
      const hotelId = hotelData.id;
      const hotelName = hotelData.name;
      const tempCode = generateTempCode();
      const t = translations[currentLang];

      const payload = {
        hotelId: hotelId,
        hotelName: hotelName,
        checkoutDate: checkoutDate,
        code: tempCode,
        language: currentLang,
        consentGiven: isConsentGiven
      };

      if (isConsentGiven) {
        payload.consentText = t.consentText(hotelName);
        payload.consentTimestamp = new Date().toISOString();
      }

      fetch("https://hook.eu2.make.com/4i2oqxrb2ne9tx798562ciopbprhwoe1", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      })
        .then(res => {
          let message;
          if (isConsentGiven) {
            message = checkoutDate
              ? t.messageWithDate(checkoutDate, payload.code)
              : t.messageWithoutDate(payload.code);
          } else {
            message = checkoutDate
              ? t.messageWithDateAndOptin(checkoutDate, payload.code)
              : t.messageWithoutDateAndOptin(payload.code);
          }
          const encodedMessage = encodeURIComponent(message);
          const whatsappLink = `https://wa.me/212653421433?text=${encodedMessage}`;
          setTimeout(() => {
            window.location.href = whatsappLink;
          }, 1000);
        })
        .catch(err => {
          console.error(err);
          alert("An error occurred. Please try again.");
        });
    }
    
    // Load hotel data + handle language + content setup
    window.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const hotelKey = params.get('hotel'); // Key used in hotels.json
      
      fetch('hotels.json')  // Change it if the file location changes
      .then(res => res.json())
      .then(data => {
        if (!hotelKey || !data[hotelKey]) throw new Error("Error: Hotel not found");
        hotelData = data[hotelKey];
        document.getElementById('hotelLogo').src = hotelData.logo;
        
        const browserLang = navigator.language.slice(0, 2);
        const supportedLangs = ['fr', 'en', 'es', 'ar'];
        const langToUse = supportedLangs.includes(browserLang) ? browserLang : 'en';
        setLanguage(langToUse);
      })
      .catch(err => {
        console.error(err);
        alert("Error: Hotel not found.");
      });
      
      // Language switcher
      languageSelect.addEventListener('change', (e) => {
        setLanguage(e.target.value);
      });

      // Disable consent checkbox
      document.getElementById('main').addEventListener('change', () => {
        const checkbox = document.getElementById('consentCheckbox');
        withConsentBtn.disabled = !checkbox.checked;
      });
      
      // Handle WhatsApp redirection
      withConsentBtn.addEventListener('click', () => {
        handleButtonClick(true);
      });

      withoutConsentBtn.addEventListener('click', () => {
        handleButtonClick(false);
      });
    });
    </script>
</body>
</html>
