<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Concierge</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-size: cover;
      background-position: center;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 30px;
      max-width: 500px;
      width: 100%;
    }

    .top-bar {
      display: flex;
      justify-content: flex-end;
    }

    #hotelLogo {
      display: block;
      margin: 0 auto 20px auto;
      height: 180px;
      max-height: 200px;
      object-fit: contain;
    }

    .header-title {
      font-weight: bold;
      font-size: 18px;
      color: #2c3e50;
      margin-bottom: 5px;
      text-align: center;
    }

    .top-bar img {
      height: 40px;
    }

    .language-switcher select {
      border-radius: 20px;
      padding: 5px;
      font-size: 14px;
    }

    h1 {
      font-size: 22px;
      color: #2c3e50;
    }

    p {
      font-size: 16px;
      color: #333;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 10px;
    }

    input[type="date"] {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 20px;
    }

    .checkbox {
      margin-bottom: 20px;
    }

    #consentLabel {
      font-size: 13px;
    }

    button {
      background-color: #25D366;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }

    button:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }

    button#withoutConsentBtn {
      background-color: transparent;
      color: #25D366;
      border: 2px solid #25D366;
      margin-top: 10px;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }

    .footer {
      margin-top: 20px;
      font-size: 12px;
      color: #888;
      text-align: center;
    }

    @media (max-width: 600px) {
      #hotelLogo {
        height: 80px;
      }
    }
  </style>
</head>
<body>
  <div class="container" id="main">
    <div class="top-bar">
      <div class="language-switcher">
        <select id="languageSelect">
          <option value="ar">🇲🇦 العربية</option>
          <option value="en">🇬🇧 English</option>
          <option value="es">🇪🇸 Español</option>
          <option value="fr">🇫🇷 Français</option>
        </select>
      </div>
    </div>
    <img id="hotelLogo" src="" alt="Hotel Logo">
    <div class="header-title" id="headerTitle"></div>

    <p id="welcomeText"></p>

    <label for="checkout" id="checkoutLabel"></label>
    <input type="date" id="checkout" name="checkout">

    <div class="checkbox">
      <label id="consentLabel">
        <input type="checkbox" id="consentCheckbox">
      </label>
    </div>

    <button id="withConsentBtn" disabled></button>
    <button id="withoutConsentBtn"></button>

    <div class="footer" id="footerText"></div>
    <div class="footer">Powered by SmartPath</div>
  </div>

  <script>
    // Translation texts for each supported language
    const translations = {
      ar: {
        title: (hotelName) => `كونسيرج فندق ${hotelName} عبر واتساب`,
        welcomeText: "أهلاً بك. تتوفر خدمة الكونسيرج عبر واتساب لمساعدتك خلال الإقامة.",
        checkoutLabel: "هل ترغب في إدخال تاريخ المغادرة؟",
        consentText: (hotelName) => `أوافق على تلقي رسائل خدمة عبر واتساب من ${hotelName} خلال إقامتي وحتى 7 أيام بعدها (تذكير المغادرة ورابط التقييم). أرسل STOP لإلغاء الاشتراك.`,
        withConsentBtn: "أوافق وأتابع على واتساب",
        withoutConsentBtn: "المتابعة بدون تحديثات",
        footer: "بموجب سياسة أعمال واتساب، يمكنك سحب موافقتك في أي وقت.",
        messageWithDate: (date, code) => `مرحبًا، أرغب في استخدام البواب الذكي. تاريخ المغادرة هو ${date}. رمزي هو ${code}`,
        messageWithoutDate: (code) => `مرحبًا، أرغب في استخدام البواب الذكي. رمزي هو ${code}`,
        messageWithDateAndOptin: (date, code) => `empty`,
        messageWithoutDateAndOptin: (code) => `empty`
      },
      en: {
        title: (hotelName) => `${hotelName} Concierge on WhatsApp`,
        welcomeText: "Welcome. Our concierge is available on WhatsApp to help during your stay.",
        checkoutLabel: "Would you like to enter your checkout date?",
        consentText: (hotelName) => `I agree to receive WhatsApp service updates from ${hotelName} during my stay and up to 7 days after (checkout reminder & review link). Reply STOP to opt out.`,
        withConsentBtn: "Agree and continue on WhatsApp",
        withoutConsentBtn: "Continue without updates",
        footer: "According to WhatsApp Business Policy, you may withdraw your consent at any time.",
        messageWithDate: (date, code) => `Hello, I would like to use the AI concierge. My checkout date is ${date}. My code is ${code}`,
        messageWithoutDate: (code) => `Hello, I would like to use the AI concierge. My code is ${code}`,
        messageWithDateAndOptin: (date, code) => `empty`,
        messageWithoutDateAndOptin: (code) => `empty`
      },
      es: {
        title: (hotelName) => `Conserje de ${hotelName} por WhatsApp`,
        welcomeText: "Nos complace darle la bienvenida. Para mejorar su experiencia, nuestro conserje virtual está disponible en WhatsApp.",
        checkoutLabel: "¿Desea ingresar su fecha de salida?",
        consentText: (hotelName) => `Acepto recibir mensajes de servicio por WhatsApp de ${hotelName} durante mi estancia y hasta 7 días después (recordatorio de salida y enlace de reseña). Responda STOP para darse de baja.`,
        withConsentBtn: "Acepto y continúo por WhatsApp",
        withoutConsentBtn: "Continuar sin actualizaciones",
        footer: "Según la política de WhatsApp Business, puede retirar su consentimiento en cualquier momento.",
        messageWithDate: (date, code) => `Hola, me gustaría utilizar el conserje virtual. Mi fecha de salida es ${date}. Mi código es ${code}`,
        messageWithoutDate: (code) => `Hola, me gustaría utilizar el conserje virtual. Mi código es ${code}`,
        messageWithDateAndOptin: (date, code) => `empty`,
        messageWithoutDateAndOptin: (code) => `empty`
      },
      fr: {
        title: (hotelName) => `Conciergerie de ${hotelName} sur WhatsApp`,
        welcomeText: "Bienvenue. Notre conciergerie est disponible sur WhatsApp pour vous aider pendant votre séjour.",
        checkoutLabel: "Souhaitez-vous renseigner votre date de départ ?",
        consentText: (hotelName) => `J’accepte de recevoir des messages de service WhatsApp de ${hotelName} pendant mon séjour et jusqu’à 7 jours après (rappel de départ & lien d’avis). Répondez STOP pour vous désabonner.`,
        withConsentBtn: "J’accepte et je continue sur WhatsApp",
        withoutConsentBtn: "Continuer sans mises à jour",
        footer: "Conformément à la politique WhatsApp Business, vous pouvez retirer votre consentement à tout moment.",
        messageWithDate: (date, code) => `Bonjour, je souhaite utiliser le concierge IA. Ma date de départ est le ${date}. Mon code est ${code}`,
        messageWithoutDate: (code) => `Bonjour, je souhaite utiliser le concierge IA. Mon code est ${code}`,
        messageWithDateAndOptin: (date, code) => `empty`,
        messageWithoutDateAndOptin: (code) => `empty`
      }
    };

    // Elements
    const languageSelect = document.getElementById('languageSelect');
    const checkoutInput = document.getElementById('checkout');
    const withConsentBtn = document.getElementById('withConsentBtn');
    const withoutConsentBtn = document.getElementById('withoutConsentBtn');
    let currentLang = 'en';
    let hotelData = null;

    // Set UI language dynamically
    function setLanguage(lang) {
      if (!translations[lang]) lang = 'en';
      currentLang = lang;

      document.documentElement.lang = lang;
      document.body.style.direction = lang === 'ar' ? 'rtl' : 'ltr';
      languageSelect.value = lang;

      const t = translations[lang];
      const hotelName = hotelData?.name || '';

      document.getElementById('headerTitle').innerText = t.title(hotelName);
      document.getElementById('welcomeText').innerText = t.welcomeText;
      document.getElementById('checkoutLabel').innerText = t.checkoutLabel;
      document.getElementById('consentLabel').innerHTML =
        `<input type="checkbox" id="consentCheckbox"> ${t.consentText(hotelName)}`;
      document.getElementById('footerText').innerText = t.footer;
      withConsentBtn.innerText = t.withConsentBtn;
      withoutConsentBtn.innerText = t.withoutConsentBtn;
    }

    // Generate temporary guest code
    function generateTempCode(length = 8) {
      const characters = 'abcdefghijklmnopqrstuvwxyz0123456789';
      let result = '';
      for (let i = 0; i < length; i++) {
        result += characters[Math.floor(Math.random() * characters.length)];
      }
      return result;
    }

    function handleButtonClick(isConsentGiven) {
      const checkoutDate = checkoutInput.value || null;
      const hotelId = hotelData.id;
      const hotelName = hotelData.name;
      const tempCode = generateTempCode();
      const t = translations[currentLang];

      const payload = {
        hotelId: hotelId,
        hotelName: hotelName,
        checkoutDate: checkoutDate,
        code: tempCode,
        language: currentLang,
        consentGiven: isConsentGiven
      };

      if (isConsentGiven) {
        payload.consentText = t.consentText(hotelName);
        payload.consentTimestamp = new Date().toISOString();
      }

      fetch("https://hook.eu2.make.com/4i2oqxrb2ne9tx798562ciopbprhwoe1", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      })
        .then(res => {
          let message;
          if (isConsentGiven) {
            message = checkoutDate
              ? t.messageWithDate(checkoutDate, payload.code)
              : t.messageWithoutDate(payload.code);
          } else {
            message = checkoutDate
              ? t.messageWithDateAndOptin(checkoutDate, payload.code)
              : t.messageWithoutDateAndOptin(payload.code);
          }
          const encodedMessage = encodeURIComponent(message);
          const whatsappLink = `https://wa.me/212653421433?text=${encodedMessage}`;
          setTimeout(() => {
            window.location.href = whatsappLink;
          }, 1000);
        })
        .catch(err => {
          console.error(err);
          alert("An error occurred. Please try again.");
        });
    }
    
    // Load hotel data + handle language + content setup
    window.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const hotelKey = params.get('hotel'); // Key used in hotels.json
      
      fetch('hotels.json')  // Change it if the file location changes
      .then(res => res.json())
      .then(data => {
        if (!hotelKey || !data[hotelKey]) throw new Error("Error: Hotel not found");
        hotelData = data[hotelKey];
        document.getElementById('hotelLogo').src = hotelData.logo;
        
        const browserLang = navigator.language.slice(0, 2);
        const supportedLangs = ['fr', 'en', 'es', 'ar'];
        const langToUse = supportedLangs.includes(browserLang) ? browserLang : 'en';
        setLanguage(langToUse);
      })
      .catch(err => {
        console.error(err);
        alert("Error: Hotel not found.");
      });
      
      // Language switcher
      languageSelect.addEventListener('change', (e) => {
        setLanguage(e.target.value);
      });

      // Disable consent checkbox
      document.getElementById('main').addEventListener('change', () => {
        const checkbox = document.getElementById('consentCheckbox');
        withConsentBtn.disabled = !checkbox.checked;
      });
      
      // Handle WhatsApp redirection
      withConsentBtn.addEventListener('click', () => {
        handleButtonClick(true);
      });

      withoutConsentBtn.addEventListener('click', () => {
        handleButtonClick(false);
      });
    });
    </script>
</body>
</html>
